<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>NEO Galaxian v3.2 - Final Fix</title>
    <style>
        body { background: #000; color: #00f0ff; text-align: center; font-family: 'Segoe UI', sans-serif; margin: 0; overflow: hidden; touch-action: none; }
        #game-container { position: relative; width: 100vw; height: 100vh; background: radial-gradient(circle, #0a0a1a 0%, #000 100%); }
        canvas { display: block; width: 100%; height: 100%; }
        #overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 100; }
        .title { font-size: 2.5em; font-weight: bold; color: #fff; text-shadow: 0 0 15px #00f0ff; margin-bottom: 20px; font-family: monospace; }
        button#startBtn { background: #00f0ff; color: #000; border: none; padding: 15px 40px; font-size: 1.2em; cursor: pointer; border-radius: 50px; font-weight: bold; }
        .hud { position: absolute; top: 15px; width: 100%; text-align: center; font-size: 1.5em; color: #fff; pointer-events: none; }
        .controls-container { position: absolute; bottom: 30px; width: 100%; display: flex; justify-content: space-between; padding: 0 25px; box-sizing: border-box; }
        .tbtn { width: 75px; height: 75px; background: rgba(255,255,255,0.1); border: 2px solid #00f0ff; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 2em; color: #fff; }
        .fire-btn { border-color: #ff3333; background: rgba(255,0,0,0.1); }
        .hidden { display: none !important; }
    </style>
</head>
<body>
    <div id="game-container">
        <div id="overlay">
            <div class="title">NEO GALAXIAN v3.2</div>
            <button id="startBtn">INICIAR MISIÃ“N</button>
        </div>
        <div class="hud">SCORE: <span id="score">0</span></div>
        <canvas id="g"></canvas>
        <div class="controls-container">
            <div style="display:flex; gap:15px;">
                <div class="tbtn" id="leftBtn">â—€</div>
                <div class="tbtn" id="rightBtn">â–¶</div>
            </div>
            <div class="tbtn fire-btn" id="fireBtn">ðŸ”¥</div>
        </div>
    </div>
    <script>
        const c = document.getElementById('g');
        const ctx = c.getContext('2d');
        const scoreEl = document.getElementById('score');
        const overlay = document.getElementById('overlay');
        
        function resize() { c.width = window.innerWidth; c.height = window.innerHeight; }
        window.addEventListener('resize', resize);
        resize();

        let score = 0, gameActive = false, enemies = [], bullets = [], dir = 1, speed = 1.2;
        let stars = Array.from({length: 80}, () => ({x: Math.random()*c.width, y: Math.random()*c.height, s: Math.random()*2 + 1}));
        let p = { x: 0, y: 0, w: 40, h: 30, speed: 7 };
        let move = { left: false, right: false };

        function initLevel() {
            enemies = [];
            const rows = 4, enemyW = 35, pad = 25;
            const cols = Math.min(7, Math.floor(c.width / (enemyW + pad)));
            const startX = (c.width - (cols * (enemyW + pad))) / 2;
            for(let r=0; r<rows; r++) {
                for(let col=0; col<cols; col++) {
                    enemies.push({ x: startX + col*(enemyW+pad), y: r*(enemyW+pad) + 70, w: enemyW, h: 25, alive: true, type: r });
                }
            }
        }

        function update() {
            if(!gameActive) return;
            if(move.left && p.x > 5) p.x -= p.speed;
            if(move.right && p.x < c.width - p.w - 5) p.x += p.speed;

            let edge = false;
            enemies.forEach(e => {
                if(!e.alive) return;
                e.x += speed * dir;
                if(e.x > c.width - 40 || e.x < 5) edge = true;
                if(e.y > p.y - 10) { gameActive = false; overlay.classList.remove('hidden'); document.querySelector('.title').innerText = "GAME OVER"; }
            });

            if(edge) { dir *= -1; enemies.forEach(e => e.y += 20); }

            bullets.forEach((b, i) => {
                b.y -= 10;
                if(b.y < 0) bullets.splice(i, 1);
                enemies.forEach(e => {
                    if(e.alive && b.x > e.x && b.x < e.x + e.w && b.y > e.y && b.y < e.y + e.h) {
                        e.alive = false; bullets.splice(i, 1); score += 100; scoreEl.innerText = score;
                    }
                });
            });

            if(enemies.length > 0 && enemies.every(e => !e.alive)) { speed += 0.5; initLevel(); }
        }

        function draw() {
            ctx.fillStyle = '#000'; ctx.fillRect(0, 0, c.width, c.height);
            ctx.fillStyle = '#fff'; stars.forEach(s => { s.y += s.s; if(s.y > c.height) s.y = 0; ctx.fillRect(s.x, s.y, 1, 1); });
            if(gameActive) {
                ctx.fillStyle = '#00f0ff'; ctx.fillRect(p.x, p.y, p.w, p.h);
                ctx.font = '24px Arial'; enemies.forEach(e => { if(e.alive) ctx.fillText('ðŸ‘¾', e.x, e.y + 20); });
                ctx.fillStyle = '#fff'; bullets.forEach(b => ctx.fillRect(b.x, b.y, 3, 10));
            }
        }

        function loop() { update(); draw(); requestAnimationFrame(loop); }

        document.getElementById('startBtn').onclick = () => {
            score = 0; scoreEl.innerText = '0'; speed = 1.2; dir = 1;
            p.x = c.width/2 - 20; p.y = c.height - 150;
            bullets = []; initLevel(); gameActive = true; overlay.classList.add('hidden');
        };

        const l = document.getElementById('leftBtn'), r = document.getElementById('rightBtn'), f = document.getElementById('fireBtn');
        l.ontouchstart = (e) => { e.preventDefault(); move.left = true; }; l.ontouchend = () => move.left = false;
        r.ontouchstart = (e) => { e.preventDefault(); move.right = true; }; r.ontouchend = () => move.right = false;
        f.ontouchstart = (e) => { e.preventDefault(); if(gameActive) bullets.push({x: p.x + 18, y: p.y}); };

        window.onkeydown = e => { if(e.key == 'ArrowLeft') move.left = true; if(e.key == 'ArrowRight') move.right = true; if(e.key == ' ') bullets.push({x: p.x + 18, y: p.y}); };
        window.onkeyup = e => { if(e.key == 'ArrowLeft') move.left = false; if(e.key == 'ArrowRight') move.right = false; };

        loop();
    </script>
</body>
</html>